<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Seamless Multi-Segment Videos (HLS)
    </title>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/highlight.min.js"></script>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <div id="navbar">
        <div class="nav-left-area">
            <button class="hamburger" onclick="document.getElementById('sidebar').classList.toggle('open')">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <a href="/index.html">Roku Guide</a>
        </div>
        <a href="https://github.com/rokucommunity/roku-guide" target="_blank" title="View project on GitHub">
            <svg xmlns="http://www.w3.org/2000/svg" style="fill: white" width="24" height="24" viewBox="0 0 24 24">
                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
            </svg>
        </a>
    </div>
    <div id="body-area">
        <div id="sidebar">

            
            
            <div class="folder">
                
                
                <div class="children">
                    
            
            <a class="entry" href="index.html">Introduction</a>
            
            
                </div>
                
                <div class="children">
                    
            
            <a class="entry" href="component-libraries.html">Component Libraries</a>
            
            
                </div>
                
                <div class="children">
                    
            
            <div class="folder">
                
                <a class="name entry" href="Performance">Performance</a>
                
                
                <div class="children">
                    
            
            <a class="entry" href="Performance/index.html">Introduction</a>
            
            
                </div>
                
                <div class="children">
                    
            
            <a class="entry" href="Performance/associative-arrays-and-nodes.html">Associative Arrays and Nodes</a>
            
            
                </div>
                
                <div class="children">
                    
            
            <a class="entry" href="Performance/cpus.html">CPUs</a>
            
            
                </div>
                
                <div class="children">
                    
            
            <a class="entry" href="Performance/registry.html">Registry</a>
            
            
                </div>
                
                <div class="children">
                    
            
            <a class="entry" href="Performance/tasks.html">Tasks</a>
            
            
                </div>
                
            </div>
            
            
                </div>
                
                <div class="children">
                    
            
            <a class="entry" href="seamless-multi-segment-hls-videos.html">Seamless Multi-Segment Videos (HLS)</a>
            
            
                </div>
                
                <div class="children">
                    
            
            <div class="folder">
                
                <a class="name entry" href="Structure">Structure</a>
                
                
                <div class="children">
                    
            
            <a class="entry" href="Structure/pattern.html">Pattern</a>
            
            
                </div>
                
                <div class="children">
                    
            
            <a class="entry" href="Structure/singleton-and-globals.html">Singleton</a>
            
            
                </div>
                
            </div>
            
            
                </div>
                
                <div class="children">
                    
            
            <div class="folder">
                
                <a class="name entry" href="UI">UI</a>
                
                
                <div class="children">
                    
            
            <a class="entry" href="UI/round-corners.html">Round corners</a>
            
            
                </div>
                
                <div class="children">
                    
            
            <a class="entry" href="UI/shadows.html">Shadows</a>
            
            
                </div>
                
            </div>
            
            
                </div>
                
                <div class="children">
                    
            
            <a class="entry" href="contributing.html">Contributing</a>
            
            
                </div>
                
            </div>
            
            

            
        </div>
        <div id="content">
            <a href="#seamless-multi-segment-videos-hls"><h1 id="seamless-multi-segment-videos-hls">Seamless Multi-Segment Videos (HLS)</h1></a><p>I had a project with short form movie review videos, but had short intros and extros to be played before and after every video.  They wanted them to be seamless, to look like they were part of the original video, but also wanted them to be globally changeable for holidays, announcements, additions to channels we tracked (Netflix, Hulu, Amazon, and soon), etc.  </p>
<p>If I treated them as separate videos, which they were, there would be loading/buffering times before each of the segments, instead of just at startup.  This was against the spec I was given by the channel owners.</p>
<p>With understanding of the m3u8 format, and using the m3u8 discontinuity feature, multiple TS segments from multiple m3u8 files can be combined to make a single seamless stream.  I don’t have any source code to provide as the source I have is from BrightScript version 3.1 and doesn’t apply to the current BrightScript/SceneGraph system. </p>
<p>The gist of my solution was to first download the m3u8 file from the Vimeo server and extract the included TS file names.  The intro/extro m3u8 files were already loaded, parsed, and cached at channel startup.  A new m3u8 file was created, and stored to TMP,  again using the m3u8 discontinuity feature, combining the intro TS files, the video TS files, and the extro TS files. </p>
<p>I then streamed the resulting m3u8 file using a roStreamSocket, from the users box (any available port would work), to play the video as if it was a single video.  Before RAF existed I also used this to embed ads supplied by Roku into the m3u8 for client side stitching, creating a single stream for the entire playback, with no interim loads.</p>
<p>Again I have no current source code to provide here, but the concept worked perfectly on our channel and is still viable as the ability to directly download files from URL and the roStreamSocket node both still exist.</p>
            <div id="footer"></div>
        </div>
    </div>
    <script>hljs.highlightAll();</script>
</body>

</html>